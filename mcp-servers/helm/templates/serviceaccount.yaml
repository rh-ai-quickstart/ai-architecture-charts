{{- $root := . }}
{{- $servers := include "mcp-servers.mergeMcpServers" . | fromJson }}
{{- range $key, $server := $servers }}
{{- if and $server.enabled $server.serviceAccount }}
{{- if $server.serviceAccount.create }}
{{- $serverDict := dict "root" $root "key" $key "server" $server }}
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ $server.serviceAccount.name | default (printf "mcp-%s" $key) }}
  labels:
    {{- include "mcp-servers.labels" $serverDict | nindent 4 }}
  {{- with $server.serviceAccount.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
automountServiceAccountToken: true
{{- end }}
{{- end }}
{{- end }}
